# 知识库Agent系统前端组件文档

## 目录

- [概述](#概述)
- [核心组件](#核心组件)
  - [聊天组件](#聊天组件)
  - [文档管理组件](#文档管理组件)
  - [用户认证组件](#用户认证组件)
  - [响应渲染组件](#响应渲染组件)
- [通用组件](#通用组件)
- [状态管理](#状态管理)
- [API客户端](#api客户端)

## 概述

知识库Agent系统前端基于TypeScript、React和Semi Design UI组件库构建，采用组件化开发方式，使用Vite作为构建工具。前端提供了直观的用户界面，支持知识库查询、文档管理、聊天会话等功能。

## 核心组件

### 聊天组件

#### SemiChat

**文件位置**: `src/components/SemiChat.tsx`  
**功能**: 主聊天界面组件，处理消息显示、发送和流式响应接收。

**主要功能**:
- 消息列表显示
- 消息发送
- 流式响应接收与渲染
- 会话管理

**关键属性**:
```typescript
interface SemiChatProps {
  currentSession: ChatSession | null;
  onCreateSession: () => Promise<ChatSession>;
}
```

**使用示例**:
```tsx
<SemiChat 
  currentSession={selectedSession} 
  onCreateSession={handleCreateSession} 
/>
```

**子组件**:
- MessageRenderer: 消息渲染
- ResponseBlock: 响应块渲染
- AnalyzingBlock: 分析块渲染
- ThinkingBlock: 思考块渲染

#### QueryInput

**文件位置**: `src/components/QueryInput.tsx`  
**功能**: 查询输入框组件，处理用户输入并提交查询。

**主要功能**:
- 文本输入处理
- 查询提交
- 快捷命令支持

**关键属性**:
```typescript
interface QueryInputProps {
  onSendMessage: (content: string) => void;
  disabled?: boolean;
  placeholder?: string;
}
```

#### SessionSelector

**文件位置**: `src/components/SessionSelector.tsx`  
**功能**: 会话选择器组件，用于管理和切换不同的聊天会话。

**主要功能**:
- 会话列表显示
- 会话切换
- 会话创建/删除/重命名

**关键属性**:
```typescript
interface SessionSelectorProps {
  sessions: ChatSession[];
  currentSession: ChatSession | null;
  onSessionSelect: (session: ChatSession) => void;
  onSessionCreate: () => void;
  onSessionDelete: (sessionId: string) => void;
  onSessionRename: (sessionId: string, newTitle: string) => void;
}
```

### 文档管理组件

#### DocumentManager

**文件位置**: `src/components/DocumentManager.tsx`  
**功能**: 文档管理界面组件，用于查看、搜索和管理上传的文档。

**主要功能**:
- 文档列表显示
- 文档搜索和过滤
- 文档元数据查看
- 文档删除

**关键属性**:
```typescript
interface DocumentManagerProps {
  onRefresh?: () => void;
}
```

**使用示例**:
```tsx
<DocumentManager onRefresh={handleRefreshDocuments} />
```

#### DocumentUploader

**文件位置**: `src/components/DocumentUploader.tsx`  
**功能**: 文档上传组件，支持多种方式上传文档到知识库。

**主要功能**:
- 文件选择和上传
- 文档元数据编辑
- 上传进度显示
- 多种上传方式(本地文件/网页URL)

**关键属性**:
```typescript
interface DocumentUploaderProps {
  onSuccess?: () => void;
  onError?: (error: string) => void;
}
```

**子组件**:
- CustomDocumentForm: 自定义文档表单
- WebDocumentForm: 网页文档表单

#### DocumentList

**文件位置**: `src/components/DocumentList.tsx`  
**功能**: 文档列表组件，展示文档列表和处理文档操作。

**主要功能**:
- 文档项渲染
- 分页控制
- 文档操作按钮

**关键属性**:
```typescript
interface DocumentListProps {
  documents: DocumentPreview[];
  total: number;
  loading: boolean;
  onPageChange: (page: number) => void;
  onDocumentSelect: (document: DocumentPreview) => void;
  onDocumentDelete: (document: DocumentPreview) => void;
  currentPage: number;
  pageSize: number;
}
```

### 用户认证组件

#### ProtectedRoute

**文件位置**: `src/components/ProtectedRoute.tsx`  
**功能**: 受保护路由组件，用于控制需要认证的页面访问。

**主要功能**:
- 认证状态检查
- 未认证时重定向
- 路由保护

**关键属性**:
```typescript
interface ProtectedRouteProps {
  children: React.ReactNode;
  redirectPath?: string;
}
```

### 响应渲染组件

#### MessageRenderer

**文件位置**: `src/components/MessageRenderer.tsx`  
**功能**: 消息渲染组件，处理不同类型消息的展示。

**主要功能**:
- 纯文本渲染
- Markdown渲染
- 代码高亮
- 打字机效果

**关键属性**:
```typescript
interface MessageRendererProps {
  content: string;
  useTypingEffect?: boolean;
  typingSpeed?: number;
  forceKey?: string;
}
```

#### MarkdownRender

**文件位置**: `src/components/MarkdownRender.tsx`  
**功能**: Markdown渲染组件，将Markdown格式文本转换为HTML并展示。

**主要功能**:
- Markdown解析
- 代码块高亮
- 数学公式支持
- 链接处理

**关键属性**:
```typescript
interface MarkdownRenderProps {
  raw: string;
  format?: 'md' | 'mdx';
}
```

#### ResponseBlock / AnalyzingBlock / ThinkingBlock / AnswerBlock

**文件位置**: 
- `src/components/ResponseBlock.tsx`
- `src/components/AnalyzingBlock.tsx`
- `src/components/ThinkingBlock.tsx`
- `src/components/AnswerBlock.tsx`

**功能**: 专门的响应块渲染组件，用于展示流式响应中的不同类型内容块。

**主要功能**:
- 特定样式和图标
- 内容格式化
- 打字机效果
- 折叠/展开控制

**关键属性**:
```typescript
interface BlockProps {
  content: string;
  forceKey?: string;
}
```

## 通用组件

### DocumentPreviewModal

**文件位置**: `src/components/DocumentPreviewModal.tsx`  
**功能**: 文档预览模态框，用于查看文档详细内容。

**主要功能**:
- 文档内容展示
- 元数据显示
- 文档类型识别

**关键属性**:
```typescript
interface DocumentPreviewModalProps {
  visible: boolean;
  document: Document | null;
  onClose: () => void;
}
```

### DocumentEditModal

**文件位置**: `src/components/DocumentEditModal.tsx`  
**功能**: 文档编辑模态框，用于编辑文档元数据。

**主要功能**:
- 文档名称编辑
- 元数据编辑
- 保存和取消操作

**关键属性**:
```typescript
interface DocumentEditModalProps {
  visible: boolean;
  document: DocumentPreview | null;
  onClose: () => void;
  onSave: (document: DocumentPreview, updates: any) => void;
}
```

### SettingsDialog

**文件位置**: `src/components/SettingsDialog.tsx`  
**功能**: 设置对话框，用于配置系统参数。

**主要功能**:
- Agent配置管理
- 界面设置
- 保存配置

**关键属性**:
```typescript
interface SettingsDialogProps {
  visible: boolean;
  onClose: () => void;
  onSave: (config: any) => void;
  initialConfig: any;
}
```

## 状态管理

前端采用React Context API进行状态管理，主要包含以下Context:

### AuthContext

**文件位置**: `src/contexts/AuthContext.tsx`  
**功能**: 管理用户认证状态和操作。

**主要状态**:
- 当前用户信息
- 登录状态
- 认证Token

**主要方法**:
- login(username, password): 用户登录
- logout(): 用户退出
- checkAuth(): 检查认证状态

### ChatContext

**文件位置**: `src/contexts/ChatContext.tsx`  
**功能**: 管理聊天相关状态和操作。

**主要状态**:
- 会话列表
- 当前会话
- 消息列表
- 加载状态

**主要方法**:
- loadSessions(): 加载会话列表
- createSession(title): 创建新会话
- sendMessage(content): 发送消息
- loadMessages(sessionId): 加载会话消息

## API客户端

API客户端负责与后端API通信，封装了各种API调用。

**文件位置**: `src/api/api.ts`

**主要模块**:

### auth
- login(username, password): 用户登录
- register(username, email, password): 用户注册
- getProfile(): 获取用户信息
- logout(): 用户退出

### agent
- query(query, sessionId, useRetrieval): 查询知识库
- uploadDocument(file): 上传文档
- getConfig(): 获取Agent配置
- updateConfig(config): 更新Agent配置

### chat
- getSessions(): 获取会话列表
- getSession(sessionId): 获取会话详情
- createSession(title): 创建新会话
- updateSession(sessionId, title): 更新会话
- deleteSession(sessionId): 删除会话
- getMessages(sessionId): 获取会话消息
- sendMessage(sessionId, role, content): 发送消息

### documents
- getDocuments(params): 获取文档列表
- getDocument(id): 获取文档详情
- updateDocument(id, updates): 更新文档
- deleteDocument(id): 删除文档
- uploadDocument(file, metadata): 上传文档

## 工具函数

**文件位置**: `src/utils/`

### contentParser.ts
解析和格式化消息内容，识别不同类型的内容块。

**主要函数**:
- parseMessageContent(content): 解析消息内容为内容块
- detectBlockType(content): 检测内容类型
- cleanBlockContent(content, type): 清理内容块内容

### tokenManager.ts
管理认证令牌的存储和获取。

**主要函数**:
- getToken(): 获取存储的令牌
- saveToken(token): 保存令牌
- clearToken(): 清除令牌

## 样式

前端使用了组合式的样式方案:

1. Semi Design的内置样式
2. 自定义CSS文件
3. 内联样式

主要样式文件:
- `src/App.css`: 应用全局样式
- `src/index.css`: 基础样式和重置
- `src/components/BlockStyles.css`: 响应块样式 